<div class="container-fluid px-4 py-3">
  <div class="row g-4">
    <!-- Main Content -->
    <div class="col-lg-8">
      <!-- Job Status Header -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-4">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <h4 class="mb-0 fw-bold text-dark">{{ project.name || 'Project Overview' }}</h4>
            <span class="badge" [class]="'bg-' + (project.status === 'done' ? 'success' : project.status === 'in_progress' ? 'primary' : project.status === 'on_hold' ? 'warning' : 'secondary') + ' fs-6 px-3 py-2 rounded-pill'">{{ project.status.replace('_', ' ') | titlecase }}</span>
          </div>
          <div class="row g-4">
            <div class="col-md-6 col-lg-3">
              <div class="form-group">
                <label class="form-label text-muted mb-2">
                  <i class="bi bi-calendar-event text-primary me-2"></i>
                  Start Date
                </label>
                <input
                  type="date"
                  class="form-control"
                  [(ngModel)]="project.starts_on"
                  style="padding: 8px 12px"
                />
              </div>
            </div>
            <div class="col-md-6 col-lg-3">
              <div class="form-group">
                <label class="form-label text-muted mb-2">
                  <i class="bi bi-calendar-check text-warning me-2"></i>
                  Due Date
                </label>
                <input
                  type="date"
                  class="form-control"
                  [(ngModel)]="project.due_on"
                  style="padding: 8px 12px"
                />
              </div>
            </div>
            <div class="col-md-6 col-lg-3">
              <div class="form-group position-relative">
                <label class="form-label text-muted mb-2">
                  <i class="bi bi-person text-success me-2"></i>
                  Assignee
                </label>
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="assigneeSearch"
                  (input)="onAssigneeSearch()"
                  (focus)="onAssigneeFocus()"
                  (blur)="onAssigneeBlur()"
                  placeholder="Search members..."
                  style="padding: 8px 12px"
                />
                @if (showAssigneeDropdown && filteredMembers.length > 0) {
                <div
                  class="dropdown-menu show position-absolute w-100 shadow-sm"
                  style="z-index: 1000; top: 100%; max-height: 200px; overflow-y: auto"
                >
                  @for (member of filteredMembers; track member.id) {
                  <button
                    type="button"
                    class="dropdown-item py-2 px-3"
                    (click)="selectAssignee(member)"
                  >
                    <i class="bi bi-person-circle me-2 text-muted"></i>
                    {{ member.full_name }}
                  </button>
                  }
                </div>
                }
              </div>
            </div>
            <div class="col-md-6 col-lg-3">
              <div class="form-group">
                <label class="form-label text-muted mb-2">
                  <i class="bi bi-clock text-info me-2"></i>
                  Status
                </label>
                <select class="form-select" [(ngModel)]="project.status" style="padding: 8px 12px">
                  @for (option of statusOptions; track option.value) {
                  <option [value]="option.value">{{ option.label }}</option>
                  }
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Section -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-0 p-4">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-file-text text-primary me-2"></i>
            Project Summary
          </h5>
        </div>
        <div class="card-body p-4">
          <p class="mb-0 text-dark lh-base">
            {{ project.summary || 'No summary provided.' }}
          </p>
        </div>
      </div>

      <!-- Service Address Section -->
      @if (project.service_address_line1 || project.service_city) {
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-0 p-4">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-geo-alt text-danger me-2"></i>
            Service Address
          </h5>
        </div>
        <div class="card-body p-4">
          <div class="text-dark">
            @if (project.service_address_line1) {
            <div>{{ project.service_address_line1 }}</div>
            }
            @if (project.service_address_line2) {
            <div>{{ project.service_address_line2 }}</div>
            }
            @if (project.service_city || project.service_state || project.service_postal_code) {
            <div>
              {{ project.service_city }}{{ project.service_state ? ', ' + project.service_state : '' }}{{ project.service_postal_code ? ' ' + project.service_postal_code : '' }}
            </div>
            }
            @if (project.service_country) {
            <div>{{ project.service_country }}</div>
            }
            @if (project.service_place_name) {
            <div class="text-muted mt-2">
              <i class="bi bi-pin-map me-1"></i>
              {{ project.service_place_name }}
            </div>
            }
            @if (project.service_access_notes) {
            <div class="mt-3">
              <strong>Access Notes:</strong>
              <p class="mb-0 mt-1">{{ project.service_access_notes }}</p>
            </div>
            }
            @if (project.service_address_line1 || project.service_city) {
            <div class="mt-3">
              <iframe 
                [src]="getMapUrl()" 
                width="100%" 
                height="200" 
                frameborder="0" 
                class="rounded"
                style="border: 1px solid #dee2e6">
              </iframe>
            </div>
            }
            <div class="mt-3">
              <a [href]="getGoogleMapsUrl()" target="_blank" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-geo-alt me-1"></i>
                View in Google Maps
              </a>
            </div>
          </div>
        </div>
      </div>
      }




    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
      <!-- Project Details -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-0 p-4">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-info-circle text-info me-2"></i>
            Project Details
          </h5>
        </div>
        <div class="card-body p-4">
          <div class="row g-3">
            <!-- <div class="col-12">
              <small class="text-muted">Project Type</small>
              <div class="fw-semibold">{{ project.type | titlecase || 'Not specified' }}</div>
            </div> -->
            <div class="col-6">
              <small class="text-muted">Project ID</small>
              <div class="fw-semibold">#{{ project.id }}</div>
            </div>
            <div class="col-12">
              <small class="text-muted">Created</small>
              <div class="fw-semibold">{{ project.created_at | readableDate }}</div>
            </div>
            <div class="col-12">
              <small class="text-muted">Last Updated</small>
              <div class="fw-semibold">{{ project.updated_at | readableDate }}</div>
            </div>
          </div>
        </div>
      </div>


    </div>
  </div>
</div>
